rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Users can only read/write their own profile document.
    match /users/{userId} {
      allow read, write: if request.auth != null
                         && request.auth.uid == userId;
    }

    // App content is readable by signed-in users, write-protected for clients.
    match /content/{contentId} {
      allow read: if request.auth != null;
      allow write: if false;
    }

    // User-specific saved items.
    match /savedContent/{savedId} {
      allow create: if request.auth != null
                    && request.resource.data.userId == request.auth.uid;
      allow read, update: if request.auth != null
                          && resource.data.userId == request.auth.uid;
      allow delete: if false;
    }

    // User-specific content progress (resume point, etc.).
    match /contentProgress/{progressId} {
      allow create: if request.auth != null
                    && request.resource.data.userId == request.auth.uid;
      allow read, update: if request.auth != null
                          && resource.data.userId == request.auth.uid;
      allow delete: if false;
    }

    // Service requests: user can create and manage only their own requests.
    match /requests/{requestId} {
      allow create: if request.auth != null
                    && request.resource.data.userId == request.auth.uid;
      allow read, update: if request.auth != null
                          && resource.data.userId == request.auth.uid;
      allow delete: if false;
    }
  }
}
